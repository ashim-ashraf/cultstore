<html lang="en">
  <head>
    <title>Shoping Cart</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!--===============================================================================================-->
    <link rel="icon" type="image/png" href="user/images/icons/favicon.png" />
    <!--===============================================================================================-->
    <link
      rel="stylesheet"
      type="text/css"
      href="user/vendor/bootstrap/css/bootstrap.min.css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <!--===============================================================================================-->
    <link
      rel="stylesheet"
      type="text/css"
      href="user/fonts/font-awesome-4.7.0/css/font-awesome.min.css"
    />
    <!--===============================================================================================-->
    <link
      rel="stylesheet"
      type="text/css"
      href="user/fonts/iconic/css/material-design-iconic-font.min.css"
    />
    <!--===============================================================================================-->
    <link
      rel="stylesheet"
      type="text/css"
      href="user/fonts/linearicons-v1.0.0/icon-font.min.css"
    />
    <!--===============================================================================================-->
    <link
      rel="stylesheet"
      type="text/css"
      href="user/vendor/animate/animate.css"
    />
    <!--===============================================================================================-->
    <link
      rel="stylesheet"
      type="text/css"
      href="user/vendor/css-hamburgers/hamburgers.min.css"
    />
    <!--===============================================================================================-->
    <link
      rel="stylesheet"
      type="text/css"
      href="user/vendor/animsition/css/animsition.min.css"
    />
    <!--===============================================================================================-->
    <link
      rel="stylesheet"
      type="text/css"
      href="user/vendor/select2/select2.min.css"
    />
	<!--===============================================================================================-->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <!--===============================================================================================-->
    <link
      rel="stylesheet"
      type="text/css"
      href="user/vendor/perfect-scrollbar/perfect-scrollbar.css"
    />
	<!--===============================================================================================-->
	<!---paypal--->
	<script src="https://www.paypal.com/sdk/js?client-id=AVnG4NIxvgMgY2Qg0HQrJ16iTof-BvWehiBUWRCB6a4inSuRtt9be5yC57GGQrs3xmCpCYb2jRNcQI9I"></script>
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="user/stylesheets/util.css" />
    <link rel="stylesheet" type="text/css" href="user/stylesheets/main.css" />
    <!--===============================================================================================-->
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

  </head>

  <body class="animsition">
    {{>userheader}}
    <!-- breadcrumb -->
    <div class="container pt-5">
      <div class="bread-crumb flex-w p-l-25 p-r-15 p-t-30 p-lr-0-lg">
        <a href="/" class="stext-109 cl8 hov-cl1 trans-04" style="text-decoration: none;">
          Home
          <i class="fa fa-angle-right m-l-9 m-r-10" aria-hidden="true"></i>
        </a>

        <span class="stext-109 cl4">
          Checkout
        </span>
      </div>
    </div>

    <section>
      <div class="container mt-5">

        <div class="row">
          <div class="col-md-6">
            <h4>Select an Address</h4>
            <p class="pt-2">
					<button class="flex-c-m stext-101 cl0  bg3 bor1 hov-btn2 p-lr-15 trans-04" type="button" data-toggle="collapse" data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
						Add new Address
					</button>
					</p>
					<div class="collapse" id="collapseExample">
					<div class="card card-body">
							<form action="" id="address-form">
							<h5>Enter Delivery Address</h5>

							<div class="pt-3">
								<label for="">First Name</label>
								<input
								class="form-control"
								type="text"
								id="fname"
								name="fname"
								/>

								<label for="">Last Name</label>
								<input
								class="form-control"
								type="text"
								id="lname"
								name="lname"
								/>

								<label for="">Address</label>
								<input
								class="form-control"
								type="text"
								id="address"
								name="address"
								/>

								<label for="">Pincode</label>
								<input
								class="form-control"
								type="text"
								id="pincode"
								name="pincode"
								/>

								<label for="">Mobile</label>
								<input
								class="form-control"
								type="text"
								id="mobile"
								name="mobile"
								/>

								<input
								type="text"
								name="userId"
								id=""
								value="{{user._id}}"
								hidden
								/>
								<div></div>
								<button
								class="flex-c-m stext-101 cl0 size-116 bg3 bor14 hov-btn3 p-lr-15 trans-04 pointer mt-5"
								type="submit"
								>Add Address</button>
							</div>
								</form>
					</div>
					</div>
            <form action="" id="payment-form">
              {{#each address}}
                <div
                  class="card col-md-12  mt-3 shadow-sm bg-white rounded"
                >
                  <div class="">
                    <p
                      class="card-text pt-3"
                      id="FirstName{{this.address._id}}"
                    >
					            Name :
                      {{this.address.fname}}
                      {{this.address.lname}},
                      <br/>
                      Mobile No :
                      {{this.address.mobile}}
                    </p>
                    <p class="card-text" id="Address{{this._id}}">
                      Address :{{this.address.address}}<br>
					            Pincode :{{this.address.pincode}}
                    </p>
                  </div>
                  <div class="d-flex justify-content-end">
                    <input
                      type="radio"
                      class="mb-4 mr-3"
                      id="vehicle1"
                      name="address"
                      value="{{this.address._id}}"
					          checked
                    required
                    />
                    <label for="vehicle1"> Use this</label>

                  </div>
                </div>

              {{/each}}
            

           
                </div>
              <div class="col-md-4">
              <div  class="container mt-5 checkout">
              <form >

                <h4
                  class="d-flex justify-content-center text-dark font-weight-bold"
                >Total Amount :₹{{total}}.00</h4>
                <hr />
                <div class="payment">
                  <p
                    class="d-flex justify-content-center text-dark font-weight-bold"
                  >Payment Method</p>
                  <hr />
                  <label class="radio-inline mt-2 text-dark font-weight-bold">
                    <input
                      type="radio"
                      name="payment"
                      value="COD"
                      
                    />COD</label>
                  <hr />
                  <label class="radio-inline mt-2 text-dark font-weight-bold">
                    <input
                      type="radio"
                      name="payment"
                      value="Razorpay"
                    />Razorpay</label>
                  <hr />
                  <label class="radio-inline mt-2 text-dark font-weight-bold">
                    <input
                      type="radio"
                      name="payment"
                      value="Paypal"
                      
                    />Paypal</label>
                  <hr />
                  <label class="radio-inline mt-2 text-dark font-weight-bold">
                    <input
                      type="radio"
                      name="payment"
                      value="Wallet"
                      
                    />Wallet</label>

                  <p class="text-dark d-flex justify-content-center ">Wallet balance :₹{{walletDetails.balance}}
                        </p>
                        
                  <hr />
                </div>

                <button
                  onclick="checkout()"
                  type="submit"
                  class="btn btn-primary btn-lg  bor14 btn-block mt-3"
                >
                  CONTINUE
                </button>
				        </form>
				
				
					

              </div>
            </div>
          </div>
        </div>

      </div>
    </section>




    <div class="pt-5"></div>

    {{>userFooter}}

    <!-- Back to top -->
    <div class="btn-back-to-top" id="myBtn">
      <span class="symbol-btn-back-to-top">
        <i class="zmdi zmdi-chevron-up"></i>
      </span>
    </div>
<script>
  //form that submits the payment option from the radio button selection
$("#payment-form").submit((e) => {
  e.preventDefault();
  $.ajax({
    url: "/proceedToPayment",
    method: "post",
    data: $("#payment-form").serialize(),
    success: (response) => {
      if(response.addressError){
         swal("Please provide delivery address", {
          icon: "warning",
        });
      } else if(response.payButtonError) {
        swal(" Please select a vallid Payment Option", {
          icon: "warning",
        });
      } else if (response.codSuccess) {
        location.href = "/orderSuccess";
      } else if (response.Razorpay) {
        razorpayPayment(response);
      } else if (response.Paypal) {
        paypalPayment(response);
      } else if (response.walletSuccess) {
        location.href = "/orderSuccess";
      } else if (response.walletBalanceError) {
        swal("Insufficient Balance In Wallet", {
          icon: "warning",
        });
      }
    },
  });
});
</script>

	<!-- razor pay-->
	<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
	<!--===============================================================================================-->
    <script src="user/javascripts/ajax.js"></script>
    <!--===============================================================================================-->
    <script src="user/vendor/jquery/jquery-3.2.1.min.js"></script>
    <!--===============================================================================================-->
    <script src="user/vendor/animsition/js/animsition.min.js"></script>
    <!--===============================================================================================-->
    <script src="user/vendor/bootstrap/js/popper.js"></script>
    <script src="user/vendor/bootstrap/js/bootstrap.min.js"></script>
    <!--===============================================================================================-->
    <script
      src="user/vendor/MagnificPopup/jquery.magnific-popup.min.js"
    ></script>
    <!--===============================================================================================-->
    <script
      src="user/vendor/perfect-scrollbar/perfect-scrollbar.min.js"
    ></script>
    <script>
      $('.js-pscroll').each(function(){ $(this).css('position','relative');
      $(this).css('overflow','hidden'); var ps = new PerfectScrollbar(this, {
      wheelSpeed: 1, scrollingThreshold: 1000, wheelPropagation: false, });
      $(window).on('resize', function(){ ps.update(); }) });
    </script>
    <!--===============================================================================================-->
    <script src="user/javascripts/main.js"></script>

  </body>
</html>